---
- name: Смена оболочки пользователя на fish
  become: true
  user:
    name: "{{ ansible_user_id }}"
    shell: /usr/bin/fish

- name: Создание Python виртуального окружения
  pip:
    name:
      - pip
      - setuptools
      - wheel
    virtualenv: "{{ ansible_facts['user_dir'] }}/.python_venv"
    virtualenv_command: python3 -m venv

- name: Создание директории памяти Gemini
  file:
    path: "{{ ansible_facts['user_dir'] }}/.gemini/memory"
    state: directory
    mode: "0700"

- name: Настройка директории .ssh
  file:
    path: "{{ ansible_facts['user_dir'] }}/.ssh"
    state: directory
    mode: "0700"

- name: Установка pre-commit хуков
  shell: "pre-commit install"
  args:
    chdir: "{{ playbook_dir }}/../.."
  become: false
  ignore_errors: yes
# Может не сработать, если нет SSH ключей
