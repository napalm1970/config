# План миграции на Ansible

Этот документ описывает этапы перехода от императивных bash-скриптов (`install.sh`) к декларативному управлению конфигурацией через Ansible.

## Структура проекта
Мы будем использовать стандартную структуру Ansible для локального использования ("Pull" модель, где localhost настраивает сам себя).

```text
ansible/
├── inventory        # Файл описи хостов (localhost)
├── ansible.cfg      # Настройки Ansible
├── playbooks/       # Основные сценарии
│   └── main.yml     # Точка входа (site.yml)
└── roles/           # Роли (модульные задачи)
    ├── system/      # Базовая настройка (локаль, время, pacman)
    ├── packages/    # Установка софта (pacman, aur)
    ├── dotfiles/    # Управление конфигами (stow или file/copy)
    ├── user/        # Настройки пользователя (shell, groups)
    └── ui/          # Hyprland, Waybar, темы
```

## Этапы перехода

### Этап 1: Подготовка (Bootstrap)
* [ ] Установить `ansible` вручную (или через мини-скрипт).
* [ ] Создать базовую структуру директорий.
* [ ] Настроить `ansible.cfg` и `inventory` для работы с `localhost`.

### Этап 2: Управление пакетами (Замена pkglist.txt)
* [ ] Создать роль `packages`.
* [ ] Перенести списки из `pkglist.txt` в переменные Ansible (`vars/main.yml` внутри роли).
* [ ] Реализовать установку пакетов через модуль `pacman`.
* [ ] Реализовать установку AUR пакетов (используя модуль `kewlfft.aur` или `yay` через `command`, но лучше модуль `aur`).

### Этап 3: Dotfiles (Симлинки)
* [ ] Создать роль `dotfiles`.
* [ ] Выбрать стратегию:
    *   **Вариант А (Простой):** Использовать модуль `file` с `state=link` для каждого конфига.
    *   **Вариант Б (GNU Stow):** Использовать Ansible для запуска `stow`, который сам раскидает симлинки (рекомендуется, так как структура репозитория уже подходит).

### Этап 4: Системные настройки и сервисы
* [ ] Настройка systemd сервисов (таймеры для обновлений, dracula-icons и т.д.).
* [ ] Настройка переменных окружения.
* [ ] Настройка Fish как дефолтного шелла.

### Этап 5: Очистка
* [ ] Протестировать playbook на чистой виртуалке или в контейнере (опционально, но рекомендуется).
* [ ] Удалить `install.sh`, `pkglist.txt` и другие старые скрипты.
* [ ] Добавить `run_ansible.sh` (простой wrapper для запуска плейбука).

## Пример запуска (Целевое состояние)
Вместо `./install.sh` мы будем запускать:
```bash
ansible-playbook ansible/playbooks/main.yml --ask-become-pass
```
