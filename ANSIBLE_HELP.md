# üìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Ansible

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Ansible** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã Arch Linux. –í—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∞ –≤ –≤–∏–¥–µ —Ä–æ–ª–µ–π –∏ –ø–ª–µ–π–±—É–∫–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ä–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å –Ω—É–ª—è –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –µ–≥–æ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç-–æ–±—ë—Ä—Ç–∫—É –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
./run_ansible.sh --ask-vault-pass
```
*–°–∫—Ä–∏–ø—Ç —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç Ansible (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç), –ø–µ—Ä–µ–π–¥–µ—Ç –≤ –Ω—É–∂–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤.*

---

## üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (Ansible Vault)

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å Bitwarden). –û–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `ansible/group_vars/all/vault.yml`.

### 1. –ö–∞–∫ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã
–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ä–æ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
ansible-vault edit ansible/group_vars/all/vault.yml
```
*(–ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å –æ—Ç Vault)*

### 2. –ö–∞–∫ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –æ—Ç —Å–∞–º–æ–≥–æ Vault
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–º —à–∏—Ñ—Ä—É–µ—Ç—Å—è —Ñ–∞–π–ª:
```bash
ansible-vault rekey ansible/group_vars/all/vault.yml
```

---

## üõ† –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å `ansible-playbook` –≤—Ä—É—á–Ω—É—é (–±–µ–∑ —Å–∫—Ä–∏–ø—Ç–∞), **–≤–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `ansible`**, –∏–Ω–∞—á–µ Ansible –Ω–µ –Ω–∞–π–¥–µ—Ç —Ä–æ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏.

### 1. –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω (Dry Run)
–†–µ–∂–∏–º `--check` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–±—ã–ª–∏ –±—ã** —Å–¥–µ–ª–∞–Ω—ã, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º.

```bash
cd ansible
ansible-playbook playbooks/main.yml --ask-vault-pass --check --diff
```
*   `--check`: –ù–µ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
*   `--diff`: –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –≤ —Ñ–∞–π–ª–∞—Ö (—á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è).

### 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–≥–æ–≤
–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ–≥–∏ (tags).
*–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç–µ–≥–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ä–æ–ª–∏, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏, –æ–≥—Ä–∞–Ω–∏—á–∏–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.*

### 3. –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–¥–µ—Ç –Ω–µ —Ç–∞–∫, –¥–æ–±–∞–≤—å—Ç–µ `-v`, `-vv` –∏–ª–∏ `-vvv` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:
```bash
./run_ansible.sh --ask-vault-pass -vv
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*   **`playbooks/main.yml`**: –ì–ª–∞–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Ä–æ–ª–∏.
*   **`roles/`**:
    *   **`packages`**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (pacman) –∏ AUR (yay).
    *   **`system`**: –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ (SDDM, —Å–ª—É–∂–±—ã, —Ç–∞–π–º–µ—Ä—ã).
    *   **`user`**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Fish shell, Python venv, SSH).
    *   **`dotfiles`**: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–ª–∏–Ω–∫–æ–≤ (—Å–≤—è–∑–µ–π) –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ `~/.config`.

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞: `the role 'packages' was not found`
**–ü—Ä–∏—á–∏–Ω–∞:** –í—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ `ansible-playbook` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, –∞ –Ω–µ –∏–∑ –ø–∞–ø–∫–∏ `ansible`.
**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./run_ansible.sh`
2. –ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É: `cd ansible` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.

### –û—à–∏–±–∫–∞: `Decryption failed`
**–ü—Ä–∏—á–∏–Ω–∞:** –í—ã –≤–≤–µ–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –æ—Ç Ansible Vault –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–ª–∏ —Ñ–ª–∞–≥ `--ask-vault-pass`.
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É —Å —Ñ–ª–∞–≥–æ–º `--ask-vault-pass` –∏ –≤–≤–µ–¥–∏—Ç–µ –≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.

### –û—à–∏–±–∫–∞: `pre-commit` failed
**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–¥–∞—á–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ö—É–∫–æ–≤ —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞ –±—ã–ª–∞ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ git (`git init`).
